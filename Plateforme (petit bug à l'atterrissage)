import pyxel
pyxel.init(256, 256, title="Tiny Adventurer")
perso_x = 128
perso_y = 182
jump= False
i=0
scroll_limitd= 190
scroll_limitg=60
scroll=0
floor=190   
last_scroll=scroll
plateforme_liste=[]

def perso_deplacement(x, y,jump,i,scroll,last_scroll):
    last_scroll=scroll
    if pyxel.btn(pyxel.KEY_RIGHT):
        if (x < scroll_limitd) :
            x = x + 3
        else: scroll+= 1
    if pyxel.btn(pyxel.KEY_LEFT):
        if (x > scroll_limitg) :
            x = x - 3
        elif scroll> 0:
            scroll-= 1
    if pyxel.btn(pyxel.KEY_SPACE):
        jump= True
    if jump == False:
      if y+9< floor:
        y= y + 8
        if y+8<4+floor and y+8>4+floor:
          y=floor-8 
    if jump == True:
        if i < 8:
            y= y - 7
            i= i + 1
        else: 
            if i < 15:
                if y+4 >= floor:
                    y= floor-8
                    jump= False
                    i=0
                    return x, y,jump,i,scroll,last_scroll
                y= y + 8
                i+= 1
            else: jump = False
    else: i=0
    return x, y,jump,i,scroll,last_scroll
    
def plateforme_creation(plateforme_liste,x,y):
    plateforme_liste.append([x,y])

def plateforme_deplacement(plaforme_liste):
    if last_scroll>scroll:
        for plateforme in plateforme_liste:
            plateforme[0]+=3
            if plateforme[0]>=256:
                plateforme_liste.remove(plateforme) 
        return plateforme_liste
    if last_scroll<scroll:
        for plateforme in plateforme_liste:
            plateforme[0]-=3
            if plateforme[0]<=-8:
                plateforme_liste.remove(plateforme) 
        return plateforme_liste    
    return plateforme_liste
            

def floor_is(floor):
  for plateforme in plateforme_liste:
    if perso_y>=plateforme[1] and perso_x+8>plateforme[0] and perso_x<plateforme[0]+8:
      floor=plateforme[1]-8
      return floor
  floor=190
  return floor
    
def update(): 
    """mise à jour des variables (30 fois par seconde)"""

    global perso_x, perso_y,jump,i, scroll, last_scroll, plateforme_liste, floor
    
    perso_x, perso_y,jump,i,scroll,last_scroll = perso_deplacement(perso_x, perso_y,jump,i,scroll,last_scroll)
    if scroll == 1 or scroll == 3 or scroll == 5:
        plateforme_creation(plateforme_liste,230,145)
    if last_scroll != scroll:
      plateforme_liste=plateforme_deplacement(plateforme_liste)
    floor=floor_is(floor)

def draw():
    """création des objets (30 fois par seconde)"""

    pyxel.cls(0)
    pyxel.rect(perso_x, perso_y-8, 8, 8, 1)
    for plateforme in plateforme_liste:
      pyxel.rect(plateforme[0], plateforme[1], 8, 8, 8) 

pyxel.run(update, draw)
